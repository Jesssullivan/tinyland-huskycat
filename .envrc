# HuskyCat development environment with direnv + Nix
# Automatically activates the Nix development shell

# Use Nix flake development shell
use flake

# Optional: Use CI shell with GPL tools
# use flake .#ci

# HuskyCat environment configuration
export HUSKYCAT_MODE=cli
export HUSKYCAT_LINTING_MODE=fast
export HUSKYCAT_TRIAGE_ENABLED=true

# Auto-sync UV dependencies when uv.lock changes
if [ -f uv.lock ]; then
  DIRENV_UV_HASH=$(md5sum uv.lock 2>/dev/null | cut -d' ' -f1 || echo "none")
  DIRENV_UV_CACHE=".direnv/uv-hash"
  mkdir -p .direnv
  if [ ! -f "$DIRENV_UV_CACHE" ] || [ "$(cat "$DIRENV_UV_CACHE")" != "$DIRENV_UV_HASH" ]; then
    log_status "uv.lock changed, running uv sync..."
    uv sync --dev 2>/dev/null && echo "$DIRENV_UV_HASH" > "$DIRENV_UV_CACHE"
  fi
fi
